{/*
  System Architecture | ç³»ç»Ÿæ¶æ„
  
  MediCare_AI ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£ / System Architecture Design Document
  ä¸­æ–‡åœ¨å‰ï¼Œè‹±æ–‡åœ¨å | Chinese first, English second
*/}

# ç³»ç»Ÿæ¶æ„ | System Architecture

> **MediCare_AI** ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£ / System Architecture Design Document  
> **ç‰ˆæœ¬ / Version:** 2.0.0 | **æ›´æ–°æ—¥æœŸ / Last Updated:** 2026-02-09

---

## ğŸ“‹ ç›®å½• | Table of Contents

1. [æ¦‚è¿° | Overview](#overview)
2. [æ¶æ„å›¾ | Architecture Diagram](#architecture-diagram)
3. [ç»„ä»¶è¯¦æƒ… | Component Details](#component-details)
4. [æ•°æ®æµ | Data Flow](#data-flow)
5. [æ•°æ®åº“è®¾è®¡ | Database Design](#database-design)
6. [å®‰å…¨æ¶æ„ | Security Architecture](#security-architecture)
7. [å¯æ‰©å±•æ€§ | Scalability](#scalability)

---

<a name="overview"></a>
## 1. æ¦‚è¿° | Overview

### 1.1 ç›®çš„ | Purpose

æœ¬æ–‡æ¡£æè¿°äº† MediCare_AI ç³»ç»Ÿçš„æ¶æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªç»“åˆ AI æ™ºèƒ½è¯Šæ–­å’Œå…¨é¢æ‚£è€…ç®¡ç†çš„æ™ºèƒ½ç–¾ç—…ç®¡ç†å¹³å°ã€‚  
This document describes the architecture of the MediCare_AI system, an intelligent disease management platform combining AI-powered diagnosis with comprehensive patient management.

### 1.2 è®¾è®¡ç›®æ ‡ | Design Goals

| ç›®æ ‡ / Goal | æè¿° / Description | ä¸­æ–‡æè¿° |
|------------|-------------------|----------|
| **å¯æ‰©å±•æ€§ / Scalability** | å¤„ç†ä¸æ–­å¢é•¿çš„ç”¨æˆ·å’Œæ•°æ® / Handle growing user base and data | å¯æ‰©å±•æ€§ |
| **å¯é æ€§ / Reliability** | é€šè¿‡é€‚å½“ç›‘æ§å®ç° 99.9% æ­£å¸¸è¿è¡Œæ—¶é—´ / 99.9% uptime with proper monitoring | å¯é æ€§ |
| **å®‰å…¨æ€§ / Security** | ç¬¦åˆ HIPAA çš„æ•°æ®ä¿æŠ¤ / HIPAA-compliant data protection | å®‰å…¨æ€§ |
| **æ€§èƒ½ / Performance** | API å“åº”æ—¶é—´å°äº 2 ç§’ / < 2s API response time | æ€§èƒ½ |
| **å¯ç»´æŠ¤æ€§ / Maintainability** | ä»£ç æ•´æ´ï¼Œæ–‡æ¡£å®Œå–„ / Clean code with comprehensive docs | å¯ç»´æŠ¤æ€§ |

### 1.3 æŠ€æœ¯æ ˆ | Technology Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯å±‚ / Frontend Layer                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HTML5 + CSS3 + JavaScript (Vanilla)                        â”‚
â”‚  â€¢ æ— éœ€æ„å»ºæ­¥éª¤ / No build step required                     â”‚
â”‚  â€¢ ä½¿ç”¨ CSS Grid/Flexbox çš„å“åº”å¼è®¾è®¡ / Responsive design     â”‚
â”‚  â€¢ Fetch API è¿›è¡Œ HTTP è¯·æ±‚ / Fetch API for HTTP requests     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API ç½‘å…³å±‚ / API Gateway                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Nginx (åå‘ä»£ç† / Reverse Proxy)                            â”‚
â”‚  â€¢ SSL/TLS ç»ˆç«¯ / SSL/TLS termination                        â”‚
â”‚  â€¢ é™æ€æ–‡ä»¶æœåŠ¡ / Static file serving                        â”‚
â”‚  â€¢ è´Ÿè½½å‡è¡¡ / Load balancing                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åç«¯å±‚ / Backend Layer                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FastAPI (Python 3.11)                                      â”‚
â”‚  â€¢ å¼‚æ­¥ SQLAlchemy ORM / Async SQLAlchemy ORM               â”‚
â”‚  â€¢ JWT è®¤è¯ / JWT authentication                            â”‚
â”‚  â€¢ è‡ªåŠ¨ OpenAPI æ–‡æ¡£ / Auto OpenAPI docs                    â”‚
â”‚  â€¢ Pydantic æ•°æ®éªŒè¯ / Pydantic validation                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL   â”‚   â”‚      Redis      â”‚   â”‚  Alibaba Cloud  â”‚
â”‚   æ•°æ®åº“       â”‚   â”‚     ç¼“å­˜        â”‚   â”‚      OSS        â”‚
â”‚ (æ•°æ®æŒä¹…åŒ–)   â”‚   â”‚  (ä¼šè¯/ç¼“å­˜)     â”‚   â”‚  (æ–‡æ¡£å­˜å‚¨)      â”‚
â”‚  + pgvector   â”‚   â”‚                 â”‚   â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AI æœåŠ¡å±‚ / AI Service Layer                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ OpenAI å…¼å®¹ API (GLM-4.7-Flash, GPT)                      â”‚
â”‚  â€¢ MinerU æ–‡æ¡£æå– / MinerU document extraction               â”‚
â”‚  â€¢ Qwen å‘é‡åµŒå…¥ / Qwen vector embeddings                     â”‚
â”‚  â€¢ Smart RAG æ£€ç´¢ / Smart RAG retrieval                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

<a name="architecture-diagram"></a>
## 2. æ¶æ„å›¾ | Architecture Diagram

### 2.1 ç³»ç»Ÿæ•´ä½“æ¶æ„ | System Overall Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ· / Users                              â”‚
â”‚    æ‚£è€…ç«¯ / Patient    åŒ»ç”Ÿç«¯ / Doctor    ç®¡ç†å‘˜ç«¯ / Admin         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Nginx åå‘ä»£ç†                               â”‚
â”‚              (SSL/TLS, é™æ€æ–‡ä»¶, è´Ÿè½½å‡è¡¡)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚               â”‚               â”‚
            â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯é¡µé¢     â”‚   â”‚   åç«¯ API    â”‚   â”‚   API æ–‡æ¡£    â”‚
â”‚  (HTML/CSS/JS)â”‚   â”‚   (FastAPI)   â”‚   â”‚  (Swagger)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL   â”‚   â”‚     Redis     â”‚   â”‚    MinerU     â”‚
â”‚   æ•°æ®åº“       â”‚   â”‚     ç¼“å­˜      â”‚   â”‚    API        â”‚
â”‚  (ä¸»æ•°æ®)      â”‚   â”‚  (ä¼šè¯/ç¼“å­˜)   â”‚   â”‚  (æ–‡æ¡£æå–)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           é˜¿é‡Œäº‘ OSS (æ–‡æ¡£å­˜å‚¨) / Alibaba Cloud OSS               â”‚
â”‚                    (å®‰å…¨æ–‡æ¡£å­˜å‚¨ / Secure document storage)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Qwen API (å‘é‡åµŒå…¥) / Qwen API (Vector Embeddings)        â”‚
â”‚              (RAG çŸ¥è¯†æ£€ç´¢ / RAG knowledge retrieval)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AI å¤§æ¨¡å‹ (OpenAI å…¼å®¹) / AI LLM (OpenAI-compatible)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

<a name="component-details"></a>
## 3. ç»„ä»¶è¯¦æƒ… | Component Details

### 3.1 å‰ç«¯å±‚ | Frontend Layer

**æŠ€æœ¯ / Technologies:**
- HTML5, CSS3, JavaScript (ES6+)
- æ— æ¡†æ¶ / No framework (Vanilla JS)
- å“åº”å¼è®¾è®¡ / Responsive design

**ä¸‰ç«¯å¹³å° / Three Platforms:**

#### æ‚£è€…ç«¯ / Patient Platform
- `index.html` - é¦–é¡µ / Homepage
- `login.html` / `register.html` - è®¤è¯ / Authentication
- `symptom-submit.html` - ç—‡çŠ¶æäº¤ / Symptom submission
- `medical-records.html` - è¯Šç–—è®°å½• / Medical records
- `user-profile.html` - ç”¨æˆ·æ¡£æ¡ˆ / User profile

#### åŒ»ç”Ÿç«¯ / Doctor Platform
- `doctor-dashboard.html` - åŒ»ç”Ÿä»ªè¡¨æ¿ / Doctor dashboard
- `doctor-mentions.html` - @æˆ‘çš„ç—…ä¾‹ / @My cases
- `doctor-case-detail.html` - ç—…ä¾‹è¯¦æƒ… / Case detail
- `doctor-profile.html` - åŒ»ç”Ÿæ¡£æ¡ˆ / Doctor profile

#### ç®¡ç†å‘˜ç«¯ / Admin Platform
- `admin-dashboard.html` - ç®¡ç†ä»ªè¡¨æ¿ / Admin dashboard
- `admin-doctors.html` - åŒ»ç”Ÿè®¤è¯ / Doctor verification
- `admin-knowledge-base.html` - çŸ¥è¯†åº“ç®¡ç† / Knowledge base management
- `admin-ai-models.html` - AI æ¨¡å‹é…ç½® / AI model configuration
- `admin-logs.html` - å®¡è®¡æ—¥å¿— / Audit logs

### 3.2 API ç½‘å…³å±‚ | API Gateway Layer

**Nginx èŒè´£ / Nginx Responsibilities:**
- SSL/TLS ç»ˆç«¯ / SSL/TLS termination
- é™æ€æ–‡ä»¶æœåŠ¡ / Static file serving
- åå‘ä»£ç†åˆ°åç«¯ / Reverse proxy to backend
- è´Ÿè½½å‡è¡¡ / Load balancing (å¤šå®ä¾‹æ—¶)
- é€Ÿç‡é™åˆ¶ / Rate limiting

### 3.3 åç«¯å±‚ | Backend Layer

**FastAPI ç‰¹æ€§ / FastAPI Features:**
- å¼‚æ­¥å¤„ç† / Async processing
- è‡ªåŠ¨ API æ–‡æ¡£ç”Ÿæˆ / Auto API doc generation
- Pydantic æ•°æ®éªŒè¯ / Pydantic data validation
- ä¾èµ–æ³¨å…¥ç³»ç»Ÿ / Dependency injection system
- JWT è®¤è¯ / JWT authentication

**æ ¸å¿ƒæ¨¡å— / Core Modules:**

```
backend/app/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ api_v1/
â”‚       â”œâ”€â”€ endpoints/          # API ç«¯ç‚¹ / API endpoints
â”‚       â”‚   â”œâ”€â”€ auth.py         # è®¤è¯ / Authentication
â”‚       â”‚   â”œâ”€â”€ patients.py     # æ‚£è€…ç®¡ç† / Patient management
â”‚       â”‚   â”œâ”€â”€ ai.py           # AI è¯Šæ–­ / AI diagnosis
â”‚       â”‚   â”œâ”€â”€ medical_cases.py # ç—…ä¾‹ / Medical cases
â”‚       â”‚   â”œâ”€â”€ documents.py    # æ–‡æ¡£ / Documents
â”‚       â”‚   â”œâ”€â”€ admin.py        # ç®¡ç† / Admin
â”‚       â”‚   â”œâ”€â”€ doctor.py       # åŒ»ç”Ÿ / Doctor
â”‚       â”‚   â””â”€â”€ sharing.py      # åˆ†äº« / Sharing
â”‚       â””â”€â”€ api.py              # è·¯ç”±èšåˆ / Router aggregation
â”œâ”€â”€ core/                       # æ ¸å¿ƒé…ç½® / Core config
â”‚   â”œâ”€â”€ config.py               # åº”ç”¨é…ç½® / App config
â”‚   â”œâ”€â”€ security.py             # å®‰å…¨ / Security
â”‚   â””â”€â”€ deps.py                 # ä¾èµ– / Dependencies
â”œâ”€â”€ models/                     # æ•°æ®åº“æ¨¡å‹ / DB models
â”‚   â””â”€â”€ models.py               # SQLAlchemy æ¨¡å‹ / SQLAlchemy models
â”œâ”€â”€ schemas/                    # Pydantic æ¨¡å¼ / Pydantic schemas
â”œâ”€â”€ services/                   # ä¸šåŠ¡é€»è¾‘ / Business logic
â”‚   â”œâ”€â”€ ai_service.py           # AI æœåŠ¡ / AI service
â”‚   â”œâ”€â”€ vector_embedding_service.py  # å‘é‡åµŒå…¥ / Vector embedding
â”‚   â”œâ”€â”€ kb_vectorization_service.py  # çŸ¥è¯†åº“å‘é‡åŒ– / KB vectorization
â”‚   â”œâ”€â”€ smart_rag_selector.py   # æ™ºèƒ½ RAG / Smart RAG
â”‚   â”œâ”€â”€ pii_cleaner_service.py  # PII æ¸…æ´— / PII cleaning
â”‚   â””â”€â”€ oss_service.py          # OSS æœåŠ¡ / OSS service
â””â”€â”€ main.py                     # åº”ç”¨å…¥å£ / App entry
```

### 3.4 æ•°æ®å±‚ | Data Layer

#### PostgreSQL æ•°æ®åº“ | PostgreSQL Database

**ä¸»è¦è¡¨ / Main Tables:**
- `users` - ç”¨æˆ· / Users
- `patients` - æ‚£è€… / Patients
- `medical_cases` - ç—…ä¾‹ / Medical cases
- `medical_documents` - æ–‡æ¡£ / Documents
- `ai_feedbacks` - AI åé¦ˆ / AI feedbacks
- `vector_embeddings` - å‘é‡åµŒå…¥ / Vector embeddings
- `doctor_verifications` - åŒ»ç”Ÿè®¤è¯ / Doctor verifications
- `shared_medical_cases` - åˆ†äº«ç—…ä¾‹ / Shared cases
- `doctor_case_comments` - åŒ»ç”Ÿè¯„è®º / Doctor comments
- `case_comment_replies` - æ‚£è€…å›å¤ / Patient replies

**pgvector æ‰©å±• / pgvector Extension:**
- å­˜å‚¨æ–‡æ¡£å‘é‡ / Store document vectors
- ç›¸ä¼¼æ€§æœç´¢ / Similarity search
- æ”¯æŒä½™å¼¦ç›¸ä¼¼åº¦ / Support cosine similarity

#### Redis ç¼“å­˜ | Redis Cache

**ç”¨é€” / Uses:**
- ç”¨æˆ·ä¼šè¯å­˜å‚¨ / User session storage
- API å“åº”ç¼“å­˜ / API response caching
- é€Ÿç‡é™åˆ¶è®¡æ•°å™¨ / Rate limiting counters
- å®æ—¶æ•°æ®ç»Ÿè®¡ / Real-time statistics

### 3.5 AI æœåŠ¡å±‚ | AI Service Layer

#### AI è¯Šæ–­æœåŠ¡ | AI Diagnosis Service

**æµç¨‹ / Flow:**
1. æ¥æ”¶æ‚£è€…ç—‡çŠ¶å’Œæ–‡æ¡£ / Receive patient symptoms and documents
2. æ£€ç´¢ç›¸å…³åŒ»ç–—æŒ‡å— / Retrieve relevant medical guidelines (RAG)
3. æ„å»ºæç¤ºè¯ / Construct prompt
4. è°ƒç”¨ AI æ¨¡å‹ / Call AI model
5. è§£æå“åº” / Parse response
6. è¿”å›ç»“æ„åŒ–è¯Šæ–­ / Return structured diagnosis

#### MinerU æ–‡æ¡£æå– | MinerU Document Extraction

**åŠŸèƒ½ / Functions:**
- PDF æ–‡æœ¬æå– / PDF text extraction
- å›¾ç‰‡ OCR / Image OCR
- è¡¨æ ¼è¯†åˆ« / Table recognition
- ç»“æ„åŒ–æ•°æ®è¾“å‡º / Structured data output

#### RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ) | RAG (Retrieval-Augmented Generation)

**ç»„ä»¶ / Components:**
- **æ–‡æ¡£å‘é‡åŒ– / Document Vectorization**: Qwen API ç”ŸæˆåµŒå…¥ / Qwen API generates embeddings
- **å‘é‡å­˜å‚¨ / Vector Storage**: PostgreSQL + pgvector
- **ç›¸ä¼¼æ€§æœç´¢ / Similarity Search**: ä½™å¼¦ç›¸ä¼¼åº¦ / Cosine similarity
- **ä¸Šä¸‹æ–‡æ„å»º / Context Building**: åŠ¨æ€æ£€ç´¢ç›¸å…³æŒ‡å— / Dynamically retrieve relevant guidelines

---

<a name="data-flow"></a>
## 4. æ•°æ®æµ | Data Flow

### 4.1 AI è¯Šæ–­æµç¨‹ | AI Diagnosis Flow

```
ç”¨æˆ·æäº¤ç—‡çŠ¶ / User submits symptoms
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ¥æ”¶è¯·æ±‚          â”‚
â”‚ Receive request     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. éªŒè¯ç”¨æˆ·          â”‚
â”‚ Validate user       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å¤„ç†æ–‡æ¡£          â”‚â”€â”€â”€â”€â–¶â”‚ MinerU æå–      â”‚
â”‚ Process documents   â”‚     â”‚ MinerU extractionâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. RAG æ£€ç´¢          â”‚â”€â”€â”€â”€â–¶â”‚ å‘é‡æ•°æ®åº“æŸ¥è¯¢    â”‚
â”‚ RAG retrieval       â”‚     â”‚ Vector DB query  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ„å»ºæç¤ºè¯        â”‚â”€â”€â”€â”€â–¶â”‚ ç—‡çŠ¶ + æ–‡æ¡£å†…å®¹   â”‚
â”‚ Build prompt        â”‚     â”‚ + çŸ¥è¯†åº“æŒ‡å—      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. è°ƒç”¨ AI æ¨¡å‹      â”‚â”€â”€â”€â”€â–¶â”‚ OpenAI å…¼å®¹ API  â”‚
â”‚ Call AI model       â”‚     â”‚ OpenAI-compatibleâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. è§£æå“åº”          â”‚
â”‚ Parse response      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. ä¿å­˜ç»“æœ          â”‚
â”‚ Save results        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
è¿”å›è¯Šæ–­ç»“æœ / Return diagnosis
```

### 4.2 åŒ»æ‚£æ²Ÿé€šæµç¨‹ | Patient-Doctor Communication Flow

```
æ‚£è€…æäº¤ç—…ä¾‹å¹¶ @åŒ»ç”Ÿ / Patient submits case and @doctor
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åˆ›å»ºåˆ†äº«ç—…ä¾‹      â”‚
â”‚ Create shared case  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å‘é€é€šçŸ¥ç»™åŒ»ç”Ÿ    â”‚
â”‚ Notify doctor       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
åŒ»ç”ŸæŸ¥çœ‹ @æˆ‘çš„ç—…ä¾‹ / Doctor views @my cases
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. åŒ»ç”Ÿæ·»åŠ è¯„è®º      â”‚
â”‚ Doctor adds comment â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. é€šçŸ¥æ‚£è€…          â”‚
â”‚ Notify patient      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
æ‚£è€…å›å¤åŒ»ç”Ÿè¯„è®º / Patient replies to doctor comment
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. é€šçŸ¥åŒ»ç”Ÿ          â”‚
â”‚ Notify doctor       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

<a name="database-design"></a>
## 5. æ•°æ®åº“è®¾è®¡ | Database Design

### 5.1 å®ä½“å…³ç³»å›¾ | Entity Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users    â”‚       â”‚   patients  â”‚       â”‚medical_casesâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚â”€â”€â”    â”‚ id (PK)     â”‚â”€â”€â”    â”‚ id (PK)     â”‚
â”‚ email       â”‚  â”‚    â”‚ user_id(FK) â”‚â—€â”€â”˜    â”‚ patient_id  â”‚
â”‚ password    â”‚  â”‚    â”‚ phone       â”‚       â”‚ disease_id  â”‚
â”‚ full_name   â”‚  â”‚    â”‚ address     â”‚       â”‚ symptoms    â”‚
â”‚ role        â”‚  â”‚    â”‚ birth_date  â”‚       â”‚ diagnosis   â”‚
â”‚ is_verified â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ severity    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                 â”‚           â”‚                     â”‚
                 â”‚           â”‚                     â”‚
                 â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”              â”‚
                 â”‚    â”‚             â”‚              â”‚
                 â”‚    â–¼             â–¼              â–¼
                 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â””â–¶â”‚doctors  â”‚  â”‚follow_ups   â”‚  â”‚medical_docs â”‚
                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                   â”‚user_id  â”‚  â”‚case_id      â”‚  â”‚case_id      â”‚
                   â”‚hospital â”‚  â”‚next_date    â”‚  â”‚filename     â”‚
                   â”‚dept     â”‚  â”‚status       â”‚  â”‚extracted    â”‚
                   â”‚verified â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚pii_cleaned  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ ¸å¿ƒè¡¨ç»“æ„ | Core Table Structures

#### users è¡¨ / users Table
```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(255) NOT NULL,
    role VARCHAR(50) NOT NULL DEFAULT 'patient',  -- patient, doctor, admin
    phone VARCHAR(50),
    is_active BOOLEAN DEFAULT true,
    is_verified BOOLEAN DEFAULT false,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE
);
```

#### medical_documents è¡¨ / medical_documents Table
```sql
CREATE TABLE medical_documents (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    medical_case_id UUID REFERENCES medical_cases(id),
    filename VARCHAR(500) NOT NULL,
    file_type VARCHAR(50),
    file_size BIGINT,
    storage_type VARCHAR(50) DEFAULT 'local',  -- local, oss
    storage_path VARCHAR(1000),
    extracted_content TEXT,
    pii_cleaned_content TEXT,
    pii_cleaning_status VARCHAR(50) DEFAULT 'pending',
    upload_status VARCHAR(50) DEFAULT 'pending',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

#### vector_embeddings è¡¨ / vector_embeddings Table
```sql
CREATE TABLE vector_embeddings (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    document_id UUID REFERENCES medical_documents(id),
    knowledge_base_id UUID,
    embedding vector(1536),  -- Qwen embedding dimension
    chunk_index INTEGER,
    chunk_text TEXT,
    metadata JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- åˆ›å»ºç›¸ä¼¼æ€§æœç´¢ç´¢å¼• / Create similarity search index
CREATE INDEX ON vector_embeddings 
USING ivfflat (embedding vector_cosine_ops);
```

---

<a name="security-architecture"></a>
## 6. å®‰å…¨æ¶æ„ | Security Architecture

### 6.1 è®¤è¯ä¸æˆæƒ | Authentication & Authorization

**JWT è®¤è¯æµç¨‹ / JWT Authentication Flow:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client â”‚â”€â”€â”€â”€â–¶â”‚   Login     â”‚â”€â”€â”€â”€â–¶â”‚   Verify    â”‚â”€â”€â”€â”€â–¶â”‚ Generateâ”‚
â”‚         â”‚     â”‚   Endpoint  â”‚     â”‚ Credentials â”‚     â”‚  JWT    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                                              â”‚
                                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client â”‚â—€â”€â”€â”€â”€â”‚   Validate  â”‚â—€â”€â”€â”€â”€â”‚   Decode    â”‚â—€â”€â”€â”€â”€â”‚  JWT    â”‚
â”‚         â”‚     â”‚    JWT      â”‚     â”‚    JWT      â”‚     â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æƒé™æ§åˆ¶ / Permission Control:**
- åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC) / Role-based access control (RBAC)
- æ‚£è€…åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ® / Patients can only access their own data
- åŒ»ç”Ÿåªèƒ½æŸ¥çœ‹è¢«æåŠçš„ç—…ä¾‹ / Doctors can only view mentioned cases
- ç®¡ç†å‘˜æ‹¥æœ‰å®Œå…¨è®¿é—®æƒé™ / Admins have full access

### 6.2 æ•°æ®ä¿æŠ¤ | Data Protection

**PII æ¸…æ´— / PII Cleaning:**
- è‡ªåŠ¨æ£€æµ‹å§“åã€èº«ä»½è¯å·ã€ç”µè¯ã€åœ°å€ / Auto-detect names, IDs, phones, addresses
- æ–‡æ¡£å­˜å‚¨å‰æ¸…æ´— / Clean before document storage
- AI å¤„ç†å‰è„±æ• / De-identify before AI processing

**ä¼ è¾“åŠ å¯† / Transport Encryption:**
- HTTPS/TLS 1.3
- JWT ä»¤ç‰Œç­¾å / JWT token signing
- API è¯·æ±‚åŠ å¯† / API request encryption

### 6.3 å®¡è®¡æ—¥å¿— | Audit Logging

**è®°å½•å†…å®¹ / Logged Content:**
- ç”¨æˆ·ç™»å½•/ç™»å‡º / User login/logout
- æ•°æ®è®¿é—® / Data access
- ç®¡ç†å‘˜æ“ä½œ / Admin operations
- AI è¯Šæ–­è¯·æ±‚ / AI diagnosis requests

---

<a name="scalability"></a>
## 7. å¯æ‰©å±•æ€§ | Scalability

### 7.1 æ°´å¹³æ‰©å±• | Horizontal Scaling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è´Ÿè½½å‡è¡¡å™¨                           â”‚
â”‚                    (Nginx/HAProxy)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                      â”‚
               â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åç«¯å®ä¾‹ 1         â”‚    â”‚   åç«¯å®ä¾‹ 2         â”‚
â”‚  (FastAPI)          â”‚    â”‚  (FastAPI)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                          â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚ â”‚    Redis    â”‚ â”‚  Alibaba    â”‚
â”‚  (ä¸»ä»å¤åˆ¶)  â”‚ â”‚   (é›†ç¾¤)     â”‚ â”‚   Cloud OSS â”‚
â”‚  ä¸»-ä»æ¶æ„   â”‚ â”‚             â”‚ â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 æ•°æ®åº“æ‰©å±• | Database Scaling

**è¯»å†™åˆ†ç¦» / Read-Write Splitting:**
- ä¸»åº“å¤„ç†å†™æ“ä½œ / Master handles writes
- ä»åº“å¤„ç†è¯»æ“ä½œ / Slaves handle reads
- è‡ªåŠ¨æ•…éšœè½¬ç§» / Automatic failover

**åˆ†åŒºç­–ç•¥ / Partitioning Strategy:**
- æŒ‰æ—¶é—´åˆ†åŒº medical_cases è¡¨ / Partition medical_cases by time
- æŒ‰ç”¨æˆ· ID å“ˆå¸Œåˆ†åŒº / Hash partition by user ID

### 7.3 ç¼“å­˜ç­–ç•¥ | Caching Strategy

**å¤šçº§ç¼“å­˜ / Multi-level Caching:**
1. **åº”ç”¨å±‚ç¼“å­˜ / Application Cache**: å‡½æ•°ç»“æœç¼“å­˜ / Function result caching
2. **Redis ç¼“å­˜ / Redis Cache**: ä¼šè¯å’Œ API å“åº” / Sessions and API responses
3. **CDN ç¼“å­˜ / CDN Cache**: é™æ€èµ„æº / Static assets

---

## å‚è€ƒèµ„æº | Reference Resources

- [FastAPI Documentation](https://fastapi.tiangolo.com/) - FastAPI æ¡†æ¶æ–‡æ¡£
- [SQLAlchemy Documentation](https://docs.sqlalchemy.org/) - SQLAlchemy ORM æ–‡æ¡£
- [PostgreSQL Documentation](https://www.postgresql.org/docs/) - PostgreSQL æ–‡æ¡£
- [Docker Documentation](https://docs.docker.com/) - Docker å®¹å™¨æ–‡æ¡£
- [System Design Primer](https://github.com/donnemartin/system-design-primer) - ç³»ç»Ÿè®¾è®¡å…¥é—¨

---

**æ–‡æ¡£ç‰ˆæœ¬ / Document Version**: 2.0.0  
**æœ€åæ›´æ–° / Last Updated**: 2026-02-09  
**ä½œè€… / Author**: è‹ä¸šé’¦ (Su Yeqin)
