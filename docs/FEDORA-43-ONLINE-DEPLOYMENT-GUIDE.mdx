{/*
  FEDORA-43-ONLINE-DEPLOYMENT-GUIDE Documentation
  
  ä¸­æ–‡åœ¨å‰ï¼Œè‹±æ–‡åœ¨å | Chinese first, English second
*/}


**æ—¥æœŸ / Date**: 2026-02-04  
**ç›®æ ‡ / Target**: Fedora 43 Server  
**çŠ¶æ€ / Status**: âœ… åœ¨çº¿éƒ¨ç½²æˆåŠŸ / Online deployment successful

---

## å…³é”®æˆåŠŸå› ç´  | Key Success Factors

### 1. å…¨å±€ç§‘å­¦ä¸Šç½‘é…ç½® | Global Proxy Configuration â­â­â­â­â­

**é—®é¢˜ / Problem**: Docker å®¹å™¨å†…éƒ¨æ— æ³•ç›´æ¥è®¿é—®å®¿ä¸»æœºä»£ç†  
Docker containers cannot directly access host proxy

**è§£å†³ / Solution**: é…ç½® v2raya ä¸º **å…¨å±€æ¨¡å¼** / Configure v2raya to **Global Mode**

**é…ç½®æ­¥éª¤ / Configuration Steps**:
```bash
# 1. å®‰è£…å¹¶å¯åŠ¨ v2raya / Install and start v2raya
sudo systemctl enable --now v2raya

# 2. è®¿é—® v2raya Web UI / Access v2raya Web UI
# http://localhost:2017

# 3. å¯¼å…¥èŠ‚ç‚¹é…ç½® / Import node configuration
# 4. è®¾ç½®ä¸ºã€å…¨å±€æ¨¡å¼ã€‘/ Set to ã€Global Modeã€‘
# 5. ç¡®è®¤ä»£ç†ç«¯å£ / Confirm proxy port: 127.0.0.1:20171 (HTTP)
```

### 2. Docker ä»£ç†é…ç½® | Docker Proxy Configuration

åˆ›å»º Docker ä»£ç†é…ç½® / Create Docker proxy configuration:
```bash
sudo mkdir -p /etc/systemd/system/docker.service.d

sudo tee /etc/systemd/system/docker.service.d/http-proxy.conf << 'EOF'
[Service]
Environment="HTTP_PROXY=http://127.0.0.1:20171/"
Environment="HTTPS_PROXY=http://127.0.0.1:20171/"
Environment="NO_PROXY=localhost,127.0.0.1,192.168.50.0/24"
EOF

# é‡å¯ Docker / Restart Docker
sudo systemctl daemon-reload
sudo systemctl restart docker
```

### 3. éªŒè¯ç½‘ç»œ | Verify Network

æµ‹è¯•å‘½ä»¤ / Test commands:
```bash
# æµ‹è¯•å¤–éƒ¨ç½‘ç»œ / Test external network
curl -s https://www.google.com -o /dev/null -w '%{http_code}'
# é¢„æœŸè¾“å‡º / Expected: 200

# æµ‹è¯• Docker Hub / Test Docker Hub
docker pull hello-world:latest
# é¢„æœŸ / Expected: æˆåŠŸæ‹‰å– / Pull successful

# æŸ¥çœ‹å‡ºå£ IP / Check exit IP
curl -s https://ipinfo.io/ip
# é¢„æœŸ / Expected: ä»£ç†æœåŠ¡å™¨ IP / Proxy server IP
```

---

## éƒ¨ç½²æ­¥éª¤ | Deployment Steps

### å®Œæ•´åœ¨çº¿éƒ¨ç½²æµç¨‹ | Complete Online Deployment Process

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½• / Enter project directory
cd /opt/medicare-ai

# 2. æ›´æ–°ç¯å¢ƒé…ç½® / Update environment configuration
cat > .env << 'EOF'
POSTGRES_PASSWORD=medicare123456
REDIS_PASSWORD=medicare123456
JWT_SECRET_KEY=fedora43-online-deploy-key-32chars
AI_API_KEY=your-api-key
AI_API_URL=http://your-ai-server:8033/v1/
MINERU_TOKEN=your-mineru-token
DEBUG=false
USE_CN_MIRROR=false
EOF

# 3. åœ¨çº¿æ„å»ºå¹¶å¯åŠ¨ / Online build and start
docker compose up --build -d

# 4. éªŒè¯éƒ¨ç½² / Verify deployment
curl http://localhost:8000/health
docker ps
```

---

## éªŒè¯ç»“æœ | Verification Results

| æ£€æŸ¥é¡¹ / Check Item | çŠ¶æ€ / Status | è¯´æ˜ / Description |
|-------------------|--------------|-------------------|
| Google è®¿é—® / Google Access | âœ… | HTTP 200 |
| Docker Hub | âœ… | æ‹‰å–æˆåŠŸ / Pull successful |
| æ„å»ºé€Ÿåº¦ / Build Speed | âœ… | apt-get update < 10s |
| å®¹å™¨å¯åŠ¨ / Container Startup | âœ… | 5/5 è¿è¡Œ / 5/5 running |
| å¥åº·æ£€æŸ¥ / Health Check | âœ… | {"status":"healthy"} |
| API æ–‡æ¡£ / API Docs | âœ… | http://server-ip:8000/docs |

---

## ç»éªŒæ€»ç»“ | Lessons Learned

### âœ… å¿…è¦æ¡ä»¶ | Required Conditions

1. **å…¨å±€ä»£ç†æ¨¡å¼ / Global Proxy Mode**: v2raya å¿…é¡»è®¾ç½®ä¸ºå…¨å±€ / v2raya must be set to global mode
2. **Docker ä»£ç† / Docker Proxy**: å¿…é¡»é€šè¿‡ systemd é…ç½® Docker ä»£ç† / Docker proxy must be configured via systemd
3. **ç½‘ç»œè¿é€šæ€§ / Network Connectivity**: éƒ¨ç½²å‰éªŒè¯ Google å’Œ Docker Hub å‡å¯è®¿é—® / Verify Google and Docker Hub accessible before deployment

### âŒ å¸¸è§é™·é˜± | Common Pitfalls

1. **ç»•è¿‡å¤§é™†æ¨¡å¼ / Bypass China Mode**: åªä»£ç†å›½å¤–åŸŸåï¼Œä½† Docker å®¹å™¨å†…éƒ¨è§£æå¯èƒ½å¤±è´¥
2. **è§„åˆ™æ¨¡å¼ / Rule Mode**: æŸäº›å¿…è¦åŸŸåå¯èƒ½æœªåœ¨è§„åˆ™ä¸­
3. **ä»…é…ç½® registry-mirrors**: åªèƒ½åŠ é€Ÿé•œåƒæ‹‰å–ï¼Œæ— æ³•åŠ é€Ÿæ„å»ºè¿‡ç¨‹ä¸­çš„ apt-get

### ğŸš€ æ€§èƒ½å¯¹æ¯” | Performance Comparison

| æŒ‡æ ‡ / Metric | æ— ä»£ç† / No Proxy | HTTP ä»£ç† / HTTP Proxy | å…¨å±€ä»£ç† / Global Proxy |
|--------------|------------------|----------------------|------------------------|
| apt-get update | è¶…æ—¶ / Timeout | >10 åˆ†é’Ÿ | <10 ç§’ âœ… |
| é•œåƒæ‹‰å– / Image Pull | å¤±è´¥ / Fail | æˆåŠŸ / Success | æˆåŠŸ / Success |
| æ„å»ºæ—¶é—´ / Build Time | ä¸å¯ç”¨ / N/A | ææ…¢ / Very slow | 3-5 åˆ†é’Ÿ âœ… |

---

## è®¿é—®åœ°å€ | Access URLs

éƒ¨ç½²å®Œæˆåè®¿é—® / Access after deployment:
- **Web UI**: http://your-server-ip/
- **API Docs**: http://your-server-ip:8000/docs
- **Health**: http://your-server-ip:8000/health

---

## ç»“è®º | Conclusion

**Fedora 43 æ”¯æŒåœ¨çº¿éƒ¨ç½²ï¼| Fedora 43 supports online deployment!**

å…³é”®æˆåŠŸå› ç´ æ˜¯é…ç½® **å…¨å±€ç§‘å­¦ä¸Šç½‘** / Key success factor is configuring **global proxy access**ã€‚

---

**è®°å½•äºº / Recorded by**: Sisyphus AI  
**éƒ¨ç½²æ—¶é—´ / Deployment Time**: 2026-02-04  
**çŠ¶æ€ / Status**: âœ… åœ¨çº¿éƒ¨ç½²éªŒè¯æˆåŠŸ / Online deployment verified successful
