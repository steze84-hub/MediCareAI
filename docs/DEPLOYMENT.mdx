{/*
  Deployment Guide | éƒ¨ç½²æŒ‡å—
  
  MediCare_AI éƒ¨ç½²å®Œæ•´æŒ‡å— / Complete deployment guide for MediCare_AI
  ä¸­æ–‡åœ¨å‰ï¼Œè‹±æ–‡åœ¨å | Chinese first, English second
*/}


> **MediCare_AI** éƒ¨ç½²å®Œæ•´æŒ‡å— / Complete deployment guide for MediCare_AI
> 
> **ç‰ˆæœ¬ / Version:** 1.0.0 | **æ›´æ–°æ—¥æœŸ / Updated:** 2025-02-01

---

## ğŸ“‹ Table of Contents | ç›®å½•

- [System Requirements | ç³»ç»Ÿè¦æ±‚](#system-requirements)
- [Quick Deployment | å¿«é€Ÿéƒ¨ç½²](#quick-deployment)
- [Detailed Installation | è¯¦ç»†å®‰è£…æ­¥éª¤](#detailed-installation)
- [Configuration Guide | é…ç½®æŒ‡å—](#configuration-guide)
- [Production Deployment | ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²](#production-deployment)
- [Troubleshooting | æ•…éšœæ’é™¤](#troubleshooting)
- [Maintenance | ç»´æŠ¤æŒ‡å—](#maintenance)

---

<a name="system-requirements"></a>
## ğŸ–¥ï¸ System Requirements | ç³»ç»Ÿè¦æ±‚

### Hardware Requirements | ç¡¬ä»¶è¦æ±‚

| Component | Minimum | Recommended | è¯´æ˜ |
|-----------|---------|-------------|------|
| **CPU** | 2 cores | 4+ cores | å¤šæ ¸æœ‰åŠ©äºå¹¶å‘å¤„ç† |
| **RAM** | 4 GB | 8+ GB | AI æ¨¡å‹éœ€è¦è¾ƒå¤šå†…å­˜ |
| **Storage** | 20 GB | 50+ GB SSD | æ•°æ®åº“å­˜å‚¨å’Œæ–‡ä»¶ä¸Šä¼  |
| **Network** | 10 Mbps | 100+ Mbps | æ–‡æ¡£ä¸Šä¼ å’Œ AI å“åº” |

### Software Requirements | è½¯ä»¶è¦æ±‚

#### Required | å¿…éœ€è½¯ä»¶
```bash
# Docker 20.10+ å®‰è£… / Installation
curl -fsSL https://get.docker.com | sh
sudo systemctl enable docker
sudo systemctl start docker

# Docker Compose 2.0+ å®‰è£… / Installation
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

#### Supported Operating Systems | æ”¯æŒçš„æ“ä½œç³»ç»Ÿ
- **Linux**: Ubuntu 20.04+, CentOS 8+, Debian 11+
- **macOS**: 11.0+ (Big Sur and later)
- **Windows**: Windows 10/11 with WSL2

---

<a name="quick-deployment"></a>
## ğŸš€ Quick Deployment | å¿«é€Ÿéƒ¨ç½²

### One-Command Deployment | ä¸€é”®éƒ¨ç½²

```bash
# å…‹éš†ä»“åº“ / Clone repository
git clone https://github.com/yourusername/MediCare_AI.git
cd MediCare_AI

# å¿«é€Ÿå¯åŠ¨è„šæœ¬ / Quick start script
./scripts/deploy.sh
```

### Manual Quick Start | æ‰‹åŠ¨å¿«é€Ÿå¼€å§‹

```bash
# 1. å‡†å¤‡ç¯å¢ƒ / Prepare environment
cp .env.example .env

# 2. ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰/ Generate self-signed certs (testing)
mkdir -p docker/nginx/ssl
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout docker/nginx/ssl/key.pem \
  -out docker/nginx/ssl/cert.pem \
  -subj "/C=CN/ST=State/L=City/O=MediCare_AI/CN=localhost"

# 3. å¯åŠ¨æœåŠ¡ / Start services
docker-compose up -d

# 4. åˆå§‹åŒ–æ•°æ®åº“ / Initialize database
docker-compose exec backend python -c "
import asyncio
from app.db.init_db import init_db
asyncio.run(init_db())
print('âœ… Database initialized successfully!')
"

# 5. éªŒè¯éƒ¨ç½² / Verify deployment
curl http://localhost/health
echo "âœ… Deployment successful! Access: http://localhost"
```

---

<a name="detailed-installation"></a>
## ğŸ“– Detailed Installation | è¯¦ç»†å®‰è£…æ­¥éª¤

### Step 1: Environment Preparation | ç¯å¢ƒå‡†å¤‡

#### 1.1 Update System | æ›´æ–°ç³»ç»Ÿ
```bash
# Ubuntu/Debian
sudo apt update && sudo apt upgrade -y

# CentOS/RHEL
sudo yum update -y
```

#### 1.2 Install Docker | å®‰è£… Docker
```bash
# Automated installation script / è‡ªåŠ¨å®‰è£…è„šæœ¬
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
newgrp docker

# Verify installation / éªŒè¯å®‰è£…
docker --version
docker-compose --version
```

### Step 2: Project Setup | é¡¹ç›®è®¾ç½®

```bash
# Clone repository / å…‹éš†ä»“åº“
git clone https://github.com/yourusername/MediCare_AI.git
cd MediCare_AI

# Create necessary directories / åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p docker/nginx/ssl
mkdir -p data/uploads
mkdir -p data/knowledge_base
mkdir -p backups
```

### Step 3: Environment Configuration | ç¯å¢ƒé…ç½®

#### 3.1 Create .env File | åˆ›å»ºç¯å¢ƒæ–‡ä»¶
```bash
cp .env.example .env
nano .env  # æˆ–ä½¿ç”¨ vim
```

#### 3.2 Required Variables | å¿…éœ€å˜é‡
```bash
# ============================================
# Database Configuration | æ•°æ®åº“é…ç½®
# ============================================
POSTGRES_PASSWORD=YourSecurePassword123!  # ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¼ºå¯†ç 
POSTGRES_USER=medicare_user
POSTGRES_DB=medicare_ai

# ============================================
# Redis Configuration | Redis é…ç½®
# ============================================
REDIS_PASSWORD=YourRedisPassword456!

# ============================================
# JWT Configuration | JWT é…ç½®
# ============================================
JWT_SECRET_KEY=your-super-secret-jwt-key-min-32-characters-long
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# ============================================
# AI API Configuration | AI API é…ç½®
# ============================================
AI_API_KEY=your-ai-api-key
AI_API_URL=http://your-ai-server:8033/v1/
AI_MODEL_ID=unsloth/GLM-4.7-Flash-GGUF:BF16

# ============================================
# MinerU API Configuration | MinerU API é…ç½®
# ============================================
MINERU_TOKEN=your-mineru-api-token

# ============================================
# Application Configuration | åº”ç”¨é…ç½®
# ============================================
DEBUG=false
LOG_LEVEL=INFO
MAX_FILE_SIZE=200000000  # 200MB in bytes
```

### Step 4: SSL Certificate Setup | SSL è¯ä¹¦é…ç½®

#### Option A: Self-Signed (Development) | è‡ªç­¾åè¯ä¹¦ï¼ˆå¼€å‘ï¼‰
```bash
mkdir -p docker/nginx/ssl
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout docker/nginx/ssl/key.pem \
  -out docker/nginx/ssl/cert.pem \
  -subj "/C=CN/ST=State/L=City/O=MediCare_AI/CN=localhost"
```

#### Option B: Let's Encrypt (Production) | Let's Encryptï¼ˆç”Ÿäº§ï¼‰
```bash
# Install certbot / å®‰è£… certbot
sudo apt install certbot

# Generate certificates / ç”Ÿæˆè¯ä¹¦
sudo certbot certonly --standalone -d your-domain.com

# Copy certificates / å¤åˆ¶è¯ä¹¦
sudo cp /etc/letsencrypt/live/your-domain.com/fullchain.pem docker/nginx/ssl/cert.pem
sudo cp /etc/letsencrypt/live/your-domain.com/privkey.pem docker/nginx/ssl/key.pem

# Setup auto-renewal / è®¾ç½®è‡ªåŠ¨ç»­æœŸ
echo "0 12 * * * /usr/bin/certbot renew --quiet" | sudo crontab -
```

### Step 5: Deploy Services | éƒ¨ç½²æœåŠ¡

```bash
# Pull latest images / æ‹‰å–æœ€æ–°é•œåƒ
docker-compose pull

# Build custom images / æ„å»ºè‡ªå®šä¹‰é•œåƒ
docker-compose build --no-cache

# Start services / å¯åŠ¨æœåŠ¡
docker-compose up -d

# Wait for database to be ready / ç­‰å¾…æ•°æ®åº“å°±ç»ª
sleep 15

# Initialize database tables / åˆå§‹åŒ–æ•°æ®åº“è¡¨
docker-compose exec backend python -c "
import asyncio
from app.db.init_db import init_db
asyncio.run(init_db())
"

# Verify all services / éªŒè¯æ‰€æœ‰æœåŠ¡
docker-compose ps
```

### Step 6: Verify Deployment | éªŒè¯éƒ¨ç½²

```bash
# Check health endpoint / æ£€æŸ¥å¥åº·ç«¯ç‚¹
curl -f http://localhost/health && echo "âœ… Health check passed"

# Check API docs / æ£€æŸ¥ API æ–‡æ¡£
curl -f http://localhost/api/docs && echo "âœ… API docs accessible"

# Check logs / æŸ¥çœ‹æ—¥å¿—
docker-compose logs --tail=50 backend
```

---

<a name="configuration-guide"></a>
## âš™ï¸ Configuration Guide | é…ç½®æŒ‡å—

### Docker Compose Configuration | Docker Compose é…ç½®

```yaml
# docker-compose.yml å…³é”®é…ç½®è¯´æ˜ / Key configuration explanation
version: '3.8'

services:
  postgres:
    image: postgres:17-alpine  # ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬ / Use latest stable
    environment:
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./docker/postgres/init.sql:/docker-entrypoint-initdb.d/init.sql
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}"]
      interval: 10s
      timeout: 5s
      retries: 5
    # ç”Ÿäº§ç¯å¢ƒèµ„æºé™åˆ¶ / Production resource limits
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G

  backend:
    build: ./backend
    environment:
      DATABASE_URL: postgresql+asyncpg://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5432/${POSTGRES_DB}
      REDIS_URL: redis://:${REDIS_PASSWORD}@redis:6379/0
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_started
    # å¥åº·æ£€æŸ¥ / Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
```

### Nginx Configuration | Nginx é…ç½®

```nginx
# docker/nginx/nginx.conf å…³é”®éƒ¨åˆ† / Key sections
server {
    listen 80;
    server_name localhost;
    
    # Redirect HTTP to HTTPS / HTTP é‡å®šå‘åˆ° HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name localhost;
    
    # SSL Configuration / SSL é…ç½®
    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    
    # Security Headers / å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Frontend / å‰ç«¯
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
        expires 1h;
        add_header Cache-Control "public, immutable";
    }
    
    # Backend API / åç«¯ API
    location /api/ {
        proxy_pass http://backend:8000/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # Timeouts / è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
}
```

---

<a name="production-deployment"></a>
## ğŸ­ Production Deployment | ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### Pre-Deployment Checklist | éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

```markdown
- [ ] æ‰€æœ‰å¯†ç å·²æ›´æ”¹ä¸ºå¼ºå¯†ç  / All passwords changed to strong passwords
- [ ] SSL è¯ä¹¦å·²é…ç½® / SSL certificates configured
- [ ] DEBUG è®¾ç½®ä¸º false / DEBUG set to false
- [ ] CORS æ¥æºå·²é™åˆ¶ / CORS origins restricted
- [ ] æ—¥å¿—çº§åˆ«è®¾ç½®ä¸º WARNING / Log level set to WARNING
- [ ] æ•°æ®åº“å¤‡ä»½ç­–ç•¥å·²é…ç½® / Database backup strategy configured
- [ ] ç›‘æ§å’Œå‘Šè­¦å·²è®¾ç½® / Monitoring and alerting configured
- [ ] é˜²ç«å¢™è§„åˆ™å·²é…ç½® / Firewall rules configured
```

### Performance Optimization | æ€§èƒ½ä¼˜åŒ–

#### Database Optimization | æ•°æ®åº“ä¼˜åŒ–
```sql
-- PostgreSQL æ€§èƒ½ä¼˜åŒ– / PostgreSQL performance tuning
-- åœ¨ docker/postgres/init.sql ä¸­æ·»åŠ  / Add to docker/postgres/init.sql

-- è¿æ¥æ•°é…ç½® / Connection settings
ALTER SYSTEM SET max_connections = '200';
ALTER SYSTEM SET shared_buffers = '1GB';
ALTER SYSTEM SET effective_cache_size = '3GB';
ALTER SYSTEM SET maintenance_work_mem = '256MB';
ALTER SYSTEM SET work_mem = '16MB';

-- æŸ¥è¯¢ä¼˜åŒ– / Query optimization
CREATE INDEX CONCURRENTLY idx_patients_user_id ON patients(user_id);
CREATE INDEX CONCURRENTLY idx_medical_cases_patient_id ON medical_cases(patient_id);
CREATE INDEX CONCURRENTLY idx_ai_feedbacks_medical_case_id ON ai_feedbacks(medical_case_id);
```

#### Application Optimization | åº”ç”¨ä¼˜åŒ–
```python
# backend/app/core/config.py
class Settings(BaseSettings):
    # è¿æ¥æ± é…ç½® / Connection pool settings
    DATABASE_POOL_SIZE: int = 20
    DATABASE_MAX_OVERFLOW: int = 10
    
    # ç¼“å­˜é…ç½® / Cache settings
    REDIS_CACHE_TTL: int = 3600  # 1 hour
    
    # æ–‡ä»¶ä¸Šä¼ é™åˆ¶ / File upload limits
    MAX_FILE_SIZE: int = 200 * 1024 * 1024  # 200MB
    MAX_UPLOAD_CONCURRENT: int = 5
```

### Security Hardening | å®‰å…¨åŠ å›º

```bash
# 1. è®¾ç½®æ–‡ä»¶æƒé™ / Set file permissions
chmod 600 .env
chmod 644 docker/nginx/nginx.conf
chmod 600 docker/nginx/ssl/*.pem

# 2. é…ç½®é˜²ç«å¢™ / Configure firewall
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable

# 3. é™åˆ¶ Docker å®¹å™¨èµ„æº / Limit Docker container resources
# åœ¨ docker-compose.yml ä¸­æ·»åŠ  / Add to docker-compose.yml
deploy:
  resources:
    limits:
      cpus: '2.0'
      memory: 4G
    reservations:
      cpus: '1.0'
      memory: 2G
```

### Backup Strategy | å¤‡ä»½ç­–ç•¥

```bash
#!/bin/bash
# scripts/backup.sh - Database backup script / æ•°æ®åº“å¤‡ä»½è„šæœ¬

BACKUP_DIR="/backups/$(date +%Y%m%d)"
mkdir -p $BACKUP_DIR

# PostgreSQL backup / PostgreSQL å¤‡ä»½
docker-compose exec -T postgres pg_dump -U medicare_user medicare_ai > $BACKUP_DIR/db_backup.sql

# Uploads backup / ä¸Šä¼ æ–‡ä»¶å¤‡ä»½
tar -czf $BACKUP_DIR/uploads_backup.tar.gz data/uploads/

# Compress backup / å‹ç¼©å¤‡ä»½
tar -czf $BACKUP_DIR.tar.gz $BACKUP_DIR
rm -rf $BACKUP_DIR

# Keep only last 7 days / åªä¿ç•™æœ€è¿‘7å¤©
find /backups -name "*.tar.gz" -mtime +7 -delete

echo "âœ… Backup completed: $BACKUP_DIR.tar.gz"
```

Add to crontab / æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡:
```bash
# æ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½ / Backup daily at 2 AM
0 2 * * * /home/houge/Dev/MediCare_AI/scripts/backup.sh >> /var/log/medicare_backup.log 2>&1
```

---

<a name="troubleshooting"></a>
## ğŸ”§ Troubleshooting | æ•…éšœæ’é™¤

### Common Issues | å¸¸è§é—®é¢˜

#### Issue 1: Services Won't Start | æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# Check port conflicts / æ£€æŸ¥ç«¯å£å†²çª
sudo lsof -i :80
sudo lsof -i :443
sudo lsof -i :8000
sudo lsof -i :5432

# Check logs / æŸ¥çœ‹æ—¥å¿—
docker-compose logs backend
docker-compose logs postgres
docker-compose logs nginx

# Restart with clean state / æ¸…ç†çŠ¶æ€åé‡å¯
docker-compose down -v
docker-compose up -d
```

#### Issue 2: Database Connection Failed | æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# Check database status / æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
docker-compose exec postgres pg_isready -U medicare_user

# View PostgreSQL logs / æŸ¥çœ‹ PostgreSQL æ—¥å¿—
docker-compose logs postgres | tail -50

# Reset database (WARNING: Data loss) / é‡ç½®æ•°æ®åº“ï¼ˆè­¦å‘Šï¼šæ•°æ®ä¸¢å¤±ï¼‰
docker-compose down -v
docker-compose up -d postgres
sleep 10
docker-compose exec backend python -c "
import asyncio
from app.db.init_db import init_db
asyncio.run(init_db())
"
```

#### Issue 3: AI Diagnosis Not Working | AI è¯Šæ–­ä¸å·¥ä½œ
```bash
# Check AI API connectivity / æ£€æŸ¥ AI API è¿æ¥
curl -f $AI_API_URL/health

# Check backend logs / æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose logs backend | grep -i "ai\|diagnosis"

# Verify environment variables / éªŒè¯ç¯å¢ƒå˜é‡
docker-compose exec backend printenv | grep AI
```

#### Issue 4: File Upload Fails | æ–‡ä»¶ä¸Šä¼ å¤±è´¥
```bash
# Check upload directory permissions / æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™
docker-compose exec backend ls -la /app/uploads/

# Check Nginx max body size / æ£€æŸ¥ Nginx æœ€å¤§è¯·æ±‚ä½“å¤§å°
docker-compose exec nginx nginx -T | grep client_max_body_size

# Check disk space / æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h
```

### Debug Mode | è°ƒè¯•æ¨¡å¼

```bash
# Enable debug logging / å¯ç”¨è°ƒè¯•æ—¥å¿—
docker-compose exec backend python -c "
import logging
logging.basicConfig(level=logging.DEBUG)
"

# Access container shell / è®¿é—®å®¹å™¨ shell
docker-compose exec backend bash
docker-compose exec postgres psql -U medicare_user -d medicare_ai

# Monitor real-time logs / å®æ—¶ç›‘æ§æ—¥å¿—
docker-compose logs -f --tail=100
```

---

<a name="maintenance"></a>
## ğŸ”§ Maintenance | ç»´æŠ¤æŒ‡å—

### Daily Maintenance | æ—¥å¸¸ç»´æŠ¤

```bash
# Check service status / æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps

# View recent logs / æŸ¥çœ‹è¿‘æœŸæ—¥å¿—
docker-compose logs --tail=100 backend

# Check disk usage / æ£€æŸ¥ç£ç›˜ä½¿ç”¨
df -h
docker system df
```

### Weekly Maintenance | å‘¨ç»´æŠ¤

```bash
# Update images / æ›´æ–°é•œåƒ
docker-compose pull
docker-compose up -d

# Clean up old containers / æ¸…ç†æ—§å®¹å™¨
docker system prune -f

# Review logs for errors / æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker-compose logs backend | grep -i error
```

### Monthly Maintenance | æœˆç»´æŠ¤

```bash
# Full system update / å…¨é¢ç³»ç»Ÿæ›´æ–°
docker-compose down
docker-compose pull
docker-compose build --no-cache
docker-compose up -d

# Database optimization / æ•°æ®åº“ä¼˜åŒ–
docker-compose exec postgres psql -U medicare_user -d medicare_ai -c "VACUUM ANALYZE;"

# Backup verification / å¤‡ä»½éªŒè¯
# Test restore from backup / æµ‹è¯•ä»å¤‡ä»½æ¢å¤
```

### Upgrade Procedure | å‡çº§æµç¨‹

```bash
# 1. Backup current data / å¤‡ä»½å½“å‰æ•°æ®
./scripts/backup.sh

# 2. Pull latest code / æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 3. Review changelog / æŸ¥çœ‹æ›´æ–°æ—¥å¿—
cat CHANGELOG.md

# 4. Update dependencies / æ›´æ–°ä¾èµ–
docker-compose pull
docker-compose build --no-cache

# 5. Deploy new version / éƒ¨ç½²æ–°ç‰ˆæœ¬
docker-compose up -d

# 6. Run migrations if needed / å¦‚éœ€è¿è¡Œè¿ç§»
docker-compose exec backend alembic upgrade head

# 7. Verify deployment / éªŒè¯éƒ¨ç½²
curl http://localhost/health
```

---

## ğŸ“ Support | æ”¯æŒ

### Getting Help | è·å–å¸®åŠ©

- **Documentation**: [Full Documentation](../README.md)
- **Issues**: [GitHub Issues](https://github.com/yourusername/MediCare_AI/issues)
- **Email**: support@medicare-ai.example.com

### Emergency Contacts | ç´§æ€¥è”ç³»

If the system is down in production / å¦‚æœç”Ÿäº§ç¯å¢ƒç³»ç»Ÿå®•æœº:

1. Check service status: `docker-compose ps`
2. Check logs: `docker-compose logs --tail=200`
3. Restart services: `docker-compose restart`
4. Contact system administrator if issue persists

---

**Last Updated | æœ€åæ›´æ–°:** 2025-02-01  
**Version | ç‰ˆæœ¬:** 1.0.0  
**Maintainers | ç»´æŠ¤è€…:** MediCare_AI Team

---

## ğŸ“š Appendix: Deployment Experience & Best Practices | é™„å½•ï¼šéƒ¨ç½²ç»éªŒä¸æœ€ä½³å®è·µ

> **Note**: This section contains practical deployment experience from real-world deployments.
> **æ³¨æ„**: æœ¬èŠ‚åŒ…å«æ¥è‡ªå®é™…éƒ¨ç½²çš„å®è·µç»éªŒã€‚

### Deployment Scenarios | éƒ¨ç½²åœºæ™¯

#### Scenario 1: Network-Restricted Environment | åœºæ™¯1ï¼šç½‘ç»œå—é™ç¯å¢ƒ

**Problem**: Frontend container npm timeout | é—®é¢˜ï¼šå‰ç«¯å®¹å™¨ npm è¶…æ—¶
```
npm error code ETIMEDOUT
npm error network request to https://registry.npmjs.org/http-server failed
```

**Root Cause**: | æ ¹æœ¬åŸå› ï¼š
- VM network environment issues
- Frontend Dockerfile uses `npx http-server`, requiring network on every start

**Solution**: | è§£å†³æ–¹æ¡ˆï¼š
```bash
# Use Nginx to serve static files directly
# ä½¿ç”¨ Nginx ç›´æ¥æä¾›é™æ€æ–‡ä»¶
# See: docker-compose.static.yml
```

**New Architecture**: | æ–°æ¶æ„ï¼š
```
Nginx (static file service) + Backend API (8000)
  â”œâ”€ /api/* â†’ Backend:8000
  â”œâ”€ /* â†’ Static HTML files
```

**Benefits**: | ä¼˜åŠ¿ï¼š
- âœ… No npm runtime dependency
- âœ… Single container, less resource usage
- âœ… Fast startup
- âœ… Not affected by network environment

#### Scenario 2: Nginx 502 Bad Gateway | åœºæ™¯2ï¼šNginx 502 é”™è¯¯

**Problem**: | é—®é¢˜ï¼š
```
502 Bad Gateway when accessing frontend
```

**Root Cause**: | æ ¹æœ¬åŸå› ï¼š
- Nginx config used `proxy_pass http://medicare_frontend:3000`
- Frontend container failed to start

**Solution**: | è§£å†³æ–¹æ¡ˆï¼š
```nginx
server {
    listen 80;
    root /usr/share/nginx/html;
    index index.html;
    
    # API routes proxy to backend
    location /api/ {
        proxy_pass http://backend:8000;
        proxy_connect_timeout 300s;
    }
    
    # Frontend static files
    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

### Multi-Distro Deployment Verification | å¤šå‘è¡Œç‰ˆéƒ¨ç½²éªŒè¯

| Distribution | Version | Status | Deployment Method |
|-------------|---------|--------|-------------------|
| Ubuntu | 24.04 LTS | âœ… Running | Online build |
| Fedora | 43 Server | âœ… Running | Pre-built images |
| openSUSE | Leap 16.0 | âœ… Running | Pre-built images |
| openSUSE | Tumbleweed | âœ… Running | Pre-built images |

### Key Lessons Learned | å…³é”®ç»éªŒæ•™è®­

**Docker Deployment**: | Docker éƒ¨ç½²
1. **Avoid runtime npm install** - Should be done at build time
2. **Use multi-stage builds** - Reduce final image size
3. **Static files first** - Use nginx to serve in production
4. **Health checks** - Every service should have healthcheck
5. **Resource limits** - Set memory and CPU limits for containers

**Network Handling**: | ç½‘ç»œå¤„ç†
1. **Offline mode support** - Detect network environment, auto-switch
2. **China mirrors** - Auto-configure npm, apt mirrors
3. **Retry mechanism** - Add retry logic to network operations
4. **Timeout settings** - Reasonable timeout values

**Fault Recovery**: | æ•…éšœæ¢å¤
1. **Auto-detection** - Regular service status checks
2. **Auto-repair** - Common issues auto-fix scripts
3. **Rollback mechanism** - Auto rollback on deployment failure
4. **Log collection** - Centralized log management

